<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600">
  <!-- Title -->
  <text x="600" y="30" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#2c3e50">
    Two-Stage Personality-Conditioned Dialogue Generation Pipeline
  </text>
  
  <!-- Input Box -->
  <rect x="50" y="80" width="200" height="120" fill="#e8f4f8" stroke="#3498db" stroke-width="2" rx="5"/>
  <text x="150" y="110" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#2c3e50">Input Dialogue</text>
  <text x="150" y="135" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#555">"Two of us might be</text>
  <text x="150" y="152" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#555">more effective than one."</text>
  <text x="150" y="180" font-family="Arial, sans-serif" font-size="11" font-style="italic" text-anchor="middle" fill="#7f8c8d">Source: Ally</text>
  
  <!-- Arrow 1 -->
  <path d="M 250 140 L 320 140" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Stage 1: Classifier -->
  <rect x="320" y="60" width="260" height="160" fill="#fff5e6" stroke="#f39c12" stroke-width="3" rx="8"/>
  <text x="450" y="85" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#d68910">STAGE 1: Classifier</text>
  
  <!-- DeBERTa Box -->
  <rect x="340" y="100" width="220" height="50" fill="#ffffff" stroke="#f39c12" stroke-width="2" rx="5"/>
  <text x="450" y="122" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2c3e50">DeBERTa-v3-base</text>
  <text x="450" y="140" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">Fine-tuned on 106K dialogues</text>
  
  <!-- Classifier Output -->
  <text x="450" y="170" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#555">Identifies archetype:</text>
  <text x="450" y="188" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#27ae60">✓ Ally (38% accuracy)</text>
  <text x="450" y="208" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#7f8c8d">8-class classifier (F1: 0.350)</text>
  
  <!-- Arrow 2 -->
  <path d="M 580 140 L 620 140" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="600" y="125" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">Target:</text>
  <text x="600" y="138" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#e74c3c">Jester</text>
  
  <!-- Stage 2: Generator -->
  <rect x="620" y="60" width="530" height="440" fill="#f0f8ff" stroke="#3498db" stroke-width="3" rx="8"/>
  <text x="885" y="85" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#2874a6">STAGE 2: Style Transfer Generator</text>
  
  <!-- FAISS Retrieval -->
  <rect x="640" y="105" width="240" height="80" fill="#ffffff" stroke="#8e44ad" stroke-width="2" rx="5"/>
  <text x="760" y="125" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2c3e50">FAISS Retrieval</text>
  <text x="760" y="143" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">Find similar Jester examples</text>
  <text x="760" y="160" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">from training data</text>
  <text x="760" y="177" font-family="Arial, sans-serif" font-size="10" font-style="italic" text-anchor="middle" fill="#7f8c8d">→ Provide style context</text>
  
  <!-- Generator Model -->
  <rect x="640" y="200" width="490" height="120" fill="#ffffff" stroke="#3498db" stroke-width="2" rx="5"/>
  <text x="885" y="225" font-family="Arial, sans-serif" font-size="15" font-weight="bold" text-anchor="middle" fill="#2c3e50">Qwen 2.5-14B-Instruct + LoRA</text>
  
  <!-- Model details -->
  <text x="660" y="250" font-family="Arial, sans-serif" font-size="12" text-anchor="start" fill="#555">• LoRA rank: 32 (efficient fine-tuning)</text>
  <text x="660" y="270" font-family="Arial, sans-serif" font-size="12" text-anchor="start" fill="#555">• Trained on 14K synthetic pairs</text>
  <text x="660" y="290" font-family="Arial, sans-serif" font-size="12" text-anchor="start" fill="#555">• Input: Original + Target archetype + Examples</text>
  <text x="660" y="310" font-family="Arial, sans-serif" font-size="12" text-anchor="start" fill="#555">• Output: Transformed dialogue</text>
  
  <!-- Prompt Construction -->
  <rect x="640" y="335" width="490" height="70" fill="#fffacd" stroke="#f39c12" stroke-width="2" rx="5"/>
  <text x="885" y="355" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#2c3e50">Prompt Template:</text>
  <text x="885" y="373" font-family="Arial, sans-serif" font-size="10" font-family="monospace" text-anchor="middle" fill="#555">"Transform the dialogue from [Ally] to [Jester] archetype</text>
  <text x="885" y="388" font-family="Arial, sans-serif" font-size="10" font-family="monospace" text-anchor="middle" fill="#555">while preserving meaning. Examples: [retrieved samples]..."</text>
  <text x="885" y="400" font-family="Arial, sans-serif" font-size="10" font-family="monospace" text-anchor="middle" fill="#555">Input: [original dialogue]"</text>
  
  <!-- Generation Metrics -->
  <rect x="640" y="420" width="490" height="70" fill="#e8f8f5" stroke="#27ae60" stroke-width="2" rx="5"/>
  <text x="885" y="440" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#27ae60">Generation Performance</text>
  <text x="750" y="460" font-family="Arial, sans-serif" font-size="11" text-anchor="start" fill="#555">• PAS: 0.435 (personality alignment)</text>
  <text x="750" y="477" font-family="Arial, sans-serif" font-size="11" text-anchor="start" fill="#555">• BERTScore: 0.875 (semantic preservation)</text>
  <text x="950" y="460" font-family="Arial, sans-serif" font-size="11" text-anchor="start" fill="#555">• Human rating: 4.69/5</text>
  <text x="950" y="477" font-family="Arial, sans-serif" font-size="11" text-anchor="start" fill="#555">• Classification: 56%</text>
  
  <!-- Arrow 3 -->
  <path d="M 885 500 L 885 530" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  
  <!-- Output Box -->
  <rect x="730" y="530" width="310" height="60" fill="#e8f8e8" stroke="#27ae60" stroke-width="3" rx="5"/>
  <text x="885" y="550" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#27ae60">Output: Transformed Dialogue</text>
  <text x="885" y="568" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#555">"Why not bring a friend? Two heads are better</text>
  <text x="885" y="583" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#555">than one, and way more fun!"</text>
  
  <!-- Data Flow Annotation -->
  <rect x="50" y="250" width="200" height="120" fill="#fff9e6" stroke="#95a5a6" stroke-width="2" rx="5" stroke-dasharray="5,5"/>
  <text x="150" y="275" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2c3e50">Training Data</text>
  <text x="150" y="295" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">106K labeled dialogues</text>
  <text x="150" y="312" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">(hybrid relabeling:</text>
  <text x="150" y="327" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">20% → 38% accuracy)</text>
  <text x="150" y="350" font-family="Arial, sans-serif" font-size="10" font-style="italic" text-anchor="middle" fill="#7f8c8d">+ 14K synthetic pairs</text>
  <text x="150" y="365" font-family="Arial, sans-serif" font-size="10" font-style="italic" text-anchor="middle" fill="#7f8c8d">(GPT-4 generated)</text>
  
  <!-- Connection arrow from training data to classifier -->
  <path d="M 250 290 L 320 180" stroke="#95a5a6" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowhead-dashed)"/>
  
  <!-- Connection arrow from training data to generator -->
  <path d="M 250 330 L 620 260" stroke="#95a5a6" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowhead-dashed)"/>
  
  <!-- Archetype Labels -->
  <rect x="50" y="420" width="200" height="170" fill="#fef5e7" stroke="#95a5a6" stroke-width="2" rx="5"/>
  <text x="150" y="445" font-family="Arial, sans-serif" font-size="13" font-weight="bold" text-anchor="middle" fill="#2c3e50">8 Archetypes</text>
  <text x="150" y="465" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">• Hero</text>
  <text x="150" y="480" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">• Mentor</text>
  <text x="150" y="495" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">• Ally</text>
  <text x="150" y="510" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">• Trickster</text>
  <text x="150" y="525" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">• Shadow</text>
  <text x="150" y="540" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">• Rebel</text>
  <text x="150" y="555" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">• Innocent</text>
  <text x="150" y="570" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#555">• Jester</text>
  
  <!-- Arrow marker definitions -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#34495e" />
    </marker>
    <marker id="arrowhead-dashed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#95a5a6" />
    </marker>
  </defs>
</svg>